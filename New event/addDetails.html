<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MeetXccelerate - Add Details</title>

    <!-- CSS File -->
    <link rel="stylesheet" href="Style.css" />
    <link rel="shortcut icon" href="./images/favicon.png" type="image/x-icon">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>

<body>
    <!-- Header -->
    <header class="main-header">
        <div class="header-right">
            <button class="icon-btn">
                <i class="fa-regular fa-circle-question" id="help"></i>
            </button>
            <img src="./images/profile.jpg" alt="User" class="profile-pic">
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        <h1>Add Event Details</h1>
        <p>Configure additional settings for your event</p>

        <form id="event-details-form">
            <!-- Location Section -->
            <div class="details-box">
                <h3>Where will this take place?</h3>
                <div class="location">
                    <input type="radio" id="zoom" name="location" value="zoom" checked>
                    <label for="zoom">Zoom Meeting</label>
                    
                    <input type="radio" id="google-meet" name="location" value="google_meet">
                    <label for="google-meet">Google Meet</label>
                    
                    <input type="radio" id="phone" name="location" value="phone">
                    <label for="phone">Phone Call</label>
                    
                    <input type="radio" id="in-person" name="location" value="in_person">
                    <label for="in-person">In Person</label>
                </div>
            </div>

            <!-- Invitee Questions -->
            <div class="details-box">
                <h4>What questions do you want to ask invitees?</h4>
                
                <label for="name-question">Name</label>
                <select id="name-question" name="name-question">
                    <option value="required">Required</option>
                    <option value="optional">Optional</option>
                    <option value="hidden">Hidden</option>
                </select>

                <label for="email-question">Email</label>
                <select id="email-question" name="email-question">
                    <option value="required">Required</option>
                    <option value="optional">Optional</option>
                    <option value="hidden">Hidden</option>
                </select>

                <div class="custom">
                    <label for="c-question">Add a custom question</label>
                    <input type="text" id="c-question" name="c-question" placeholder="Enter your question">
                </div>
            </div>

            <button type="button" class="back" onclick="goBack()">Back</button>
            <button type="submit" class="next">Save & Continue</button>
        </form>
    </main>

    <!-- JavaScript -->
    <script src="../project/js/api.js"></script>
    <script>
        function goBack() {
            window.location.href = 'selectDate.html';
        }

        document.getElementById('event-details-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const location = formData.get('location');
            const customQuestion = formData.get('c-question');
            
            // Get event data from previous steps
            const eventData = JSON.parse(sessionStorage.getItem('newEventData') || '{}');
            const selectedDate = sessionStorage.getItem('selectedDate');
            
            // Update event data with details
            eventData.location_type = location;
            eventData.custom_questions = customQuestion ? [
                { question: customQuestion, type: 'text', required: false }
            ] : [];
            
            try {
                // Create the event type
                await window.api.createEventType(eventData);
                
                // Clear session storage
                sessionStorage.removeItem('newEventData');
                sessionStorage.removeItem('selectedDate');
                
                // Redirect to success page
                window.location.href = 'myEvents.html';
            } catch (error) {
                console.error('Failed to create event:', error);
                alert('Failed to create event: ' + error.message);
            }
        });

        // Load event data on page load
        document.addEventListener('DOMContentLoaded', function() {
            const eventData = JSON.parse(sessionStorage.getItem('newEventData') || '{}');
            if (eventData.name) {
                document.querySelector('h1').textContent = `Add Details for "${eventData.name}"`;
            }
        });
    </script>
</body>

</html>