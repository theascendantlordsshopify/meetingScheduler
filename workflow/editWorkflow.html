<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MeetXccelerate - Edit workflow</title>

    <!-- CSS File -->
    <link rel="stylesheet" href="editWorkflow.css" />
    <link rel="shortcut icon" href="./images/favicon.png" type="image/x-icon">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

</head>

<body>
    <!-- Header -->
    <header class="main-header">
        <div class="header-right">
            <button class="icon-btn">
                <i class="fa-regular fa-circle-question" id="help"></i>
            </button>
            <img src="./images/profile.jpg" alt="User" class="profile-pic">
        </div>
    </header>

    <main class="container">
        <!-- Left: Triggers & Actions -->
        <div class="section">
            <h2>Triggers</h2>
            <div class="list">
                <div class="list-item">
                    <i class="fa-solid fa-calendar"></i>
                    <div>
                        <p>Meeting Created</p>
                        <small>Triggered when a new meeting is scheduled</small>
                    </div>
                </div>

                <div class="list-item">
                    <i class="fa-solid fa-x"></i>
                    <div>
                        <p>Meeting Canceled</p>
                        <small>Triggered when a meeting is canceled</small>
                    </div>
                </div>

                <div class="list-item">
                    <i class="fa-solid fa-calendar"></i>
                    <div>
                        <p>Meeting rescheduled</p>
                        <small>Triggered when a meeting is rescheduled</small>
                    </div>
                </div>
            </div>

            <h2>Actions</h2>
            <div class="list">
                <div class="list-item">
                    <i class="fa-solid fa-envelope"></i>
                    <div>
                        <p>Send Email</p>
                        <small>Send an email notification</small>
                    </div>
                </div>

                <div class="list-item">
                    <i class="fa-solid fa-calendar-week"></i>
                    <div>
                        <p>Add to Calendar</p>
                        <small>Add the meeting to a calendar</small>
                    </div>
                </div>

                <div class="list-item">
                    <i class="fa-brands fa-slack"></i>
                    <div>
                        <p>Slack Notification</p>
                        <small>Send a notification via Slack</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Middle: Workflow -->
        <div class="section">
            <h2>Edit Workflow</h2>
            <small>Drag and drop triggers and actions to build your workflow</small>
            <div class="workflow-canvas">
                <p>Workflow Canvas</p>
                <span>Meeting Created → Send Email → Add to Calendar</span>
                <br><br>
                <button>Edit</button>
            </div>
            <div class="actions">
                <button class="cancel">Cancel</button>
                <button class="save">Save Changes</button>
            </div>
        </div>

        <!-- Right: Node Properties -->
        <div class="section node-properties">
            <h2>Node Properties</h2>
            <label for="nodeName">Node Name</label>
            <input type="text" id="nodeName" placeholder="Enter node name">

            <label for="eventType">Event Type</label>
            <input type="text" id="eventType" placeholder="Enter event type">

            <label for="user">User</label>
            <input type="text" id="user" placeholder="Enter user">

            <label for="team">Team</label>
            <input type="text" id="team" placeholder="Enter team">
        </div>

    </main>

    <script>
        // Select DOM elements
        const triggers = document.querySelectorAll(".list-item");
        const workflowCanvas = document.querySelector(".workflow-canvas");
        const nodeNameInput = document.getElementById("nodeName");
        const eventTypeInput = document.getElementById("eventType");
        const userInput = document.getElementById("user");
        const teamInput = document.getElementById("team");
        const saveBtn = document.querySelector(".save");
        const cancelBtn = document.querySelector(".cancel");

        let selectedNode = null; // Track currently selected node

        // Make list items draggable
        triggers.forEach(item => {
            item.setAttribute("draggable", true);

            item.addEventListener("dragstart", e => {
                e.dataTransfer.setData("text/plain", item.innerHTML);
            });
        });

        // Allow drop on workflow canvas
        workflowCanvas.addEventListener("dragover", e => {
            e.preventDefault();
        });

        workflowCanvas.addEventListener("drop", e => {
            e.preventDefault();

            const data = e.dataTransfer.getData("text/plain");
            const newNode = document.createElement("div");
            newNode.classList.add("workflow-node");
            newNode.innerHTML = data;

            // Add click handler to select node
            newNode.addEventListener("click", () => {
                selectNode(newNode);
            });

            workflowCanvas.appendChild(newNode);
        });

        // Select a workflow node
        function selectNode(node) {
            if (selectedNode) selectedNode.classList.remove("active-node");
            selectedNode = node;
            selectedNode.classList.add("active-node");

            // Populate node properties
            nodeNameInput.value = selectedNode.innerText.split("\n")[0] || "";
            eventTypeInput.value = "Custom Event";
            userInput.value = "";
            teamInput.value = "";
        }

        // Update node properties live
        [nodeNameInput, eventTypeInput, userInput, teamInput].forEach(input => {
            input.addEventListener("input", () => {
                if (selectedNode) {
                    selectedNode.querySelector("p").innerText = nodeNameInput.value || "Unnamed Node";
                }
            });
        });

        // Save button
        saveBtn.addEventListener("click", () => {
            const nodes = document.querySelectorAll(".workflow-node p");
            const workflow = Array.from(nodes).map(n => n.innerText);
            alert("Workflow Saved: " + workflow.join(" → "));
        });

        // Cancel button
        cancelBtn.addEventListener("click", () => {
            if (confirm("Are you sure you want to clear the workflow?")) {
                workflowCanvas.innerHTML = "<p>Workflow Canvas</p>";
                selectedNode = null;
                nodeNameInput.value = "";
                eventTypeInput.value = "";
                userInput.value = "";
                teamInput.value = "";
            }
        });

    </script>

</body>

</html>