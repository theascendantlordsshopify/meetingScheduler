<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MeetXccelerate - Create New Workflow</title>

    <!-- CSS File -->
    <link rel="stylesheet" href="createNewWorkflow.css" />
    <link rel="shortcut icon" href="./images/favicon.png" type="image/x-icon">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>

<body>
    <!-- Header -->
    <header class="main-header">
        <div class="header-right">
            <button class="icon-btn">
                <i class="fa-regular fa-circle-question"></i>
            </button>
            <img src="./images/profile.jpg" alt="User" class="profile-pic">
        </div>
    </header>

    <main class="container">
        <div class="step">Step 1 of 2</div>
        <div class="progress-bar">
            <div class="progress"></div>
        </div>

        <h2>Create New Workflow</h2>

        <form id="workflow-form">
            <label for="workflow-name">Workflow Name</label>
            <input type="text" id="workflow-name" name="workflow-name" placeholder="Enter workflow name" required>

            <label for="workflow-description">Description</label>
            <input type="text" id="workflow-description" name="workflow-description" placeholder="Describe what this workflow does">

            <label for="trigger-type">Trigger</label>
            <select id="trigger-type" name="trigger-type" required>
                <option value="">Select a trigger...</option>
                <!-- Options will be loaded dynamically -->
            </select>

            <button type="submit" class="btn">Continue</button>
        </form>
    </main>

    <!-- JavaScript -->
    <script src="../project/js/api.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            await loadTriggerOptions();
            setupForm();
        });

        async function loadTriggerOptions() {
            try {
                const triggers = await window.api.getWorkflowTriggers();
                const select = document.getElementById('trigger-type');
                
                triggers.forEach(trigger => {
                    const option = document.createElement('option');
                    option.value = trigger.trigger_type;
                    option.textContent = trigger.name;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Failed to load triggers:', error);
            }
        }

        function setupForm() {
            document.getElementById('workflow-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const formData = new FormData(e.target);
                const workflowData = {
                    name: formData.get('workflow-name'),
                    description: formData.get('workflow-description'),
                    trigger_type: formData.get('trigger-type'),
                    trigger_conditions: {},
                    actions: [],
                    status: 'draft'
                };

                try {
                    await window.api.createWorkflow(workflowData);
                    alert('Workflow created successfully!');
                    window.location.href = '../project/workflows.html';
                } catch (error) {
                    console.error('Failed to create workflow:', error);
                    alert('Failed to create workflow: ' + error.message);
                }
            });
        }
    </script>
</body>

</html>